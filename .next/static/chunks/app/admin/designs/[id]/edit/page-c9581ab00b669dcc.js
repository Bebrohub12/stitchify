(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[383],{3845:function(e,s,t){Promise.resolve().then(t.bind(t,6219))},6219:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return j},dynamic:function(){return b}});var a=t(5583),r=t(1780),i=t(7437),l=t(2265),c=t(9376),d=t(9501),n=t(1713),o=t(1770),m=t(6367),u=t(3739),p=t(3922),x=t(6325),g=t(3464),h=t(7648),f=t(9064),y=t(6908);let b="force-dynamic";function j(){let e=(0,c.useParams)(),s=(0,c.useRouter)(),t=e.id,[b,j]=(0,l.useState)(!1),[N,v]=(0,l.useState)([]),[w,_]=(0,l.useState)([]),[k,C]=(0,l.useState)([]),[F,S]=(0,l.useState)({}),[q,D]=(0,l.useState)([]),{register:E,handleSubmit:P,formState:{errors:Z},setValue:I,watch:A,reset:O}=(0,d.cI)({defaultValues:{difficulty:"Beginner",formats:[],categories:[],price:0,stitchCount:0,featured:!1,popular:!1}}),{data:U}=(0,n.a)({queryKey:["adminCategories"],queryFn:async()=>(await g.Z.get("/api/admin/categories")).data}),{data:B,isLoading:R}=(0,n.a)({queryKey:["adminDesignEdit",t],queryFn:async()=>(await g.Z.get("/api/admin/designs/".concat(t))).data});(0,l.useEffect)(()=>{B&&(O({title:B.title,description:B.description,price:B.price,difficulty:B.difficulty,stitchCount:B.stitchCount,categories:B.categories.map(e=>e._id),formats:B.formats,tags:B.tags.join(", "),featured:B.featured,popular:B.popular||!1}),C(B.images||[]),D(B.formats||[]))},[B,O]);let L=e=>{v(s=>s.filter((s,t)=>t!==e)),URL.revokeObjectURL(w[e]),_(s=>s.filter((s,t)=>t!==e))},T=e=>{C(s=>s.filter((s,t)=>t!==e))},X=(e,s)=>{e.target.files&&e.target.files.length>0&&S(t=>(0,r._)((0,a._)({},t),{[s]:e.target.files[0]}))},J=e=>{S(s=>(0,r._)((0,a._)({},s),{[e]:null}))},K=(e,s)=>{s?D(s=>[...s,e]):(D(s=>s.filter(s=>s!==e)),S(s=>(0,r._)((0,a._)({},s),{[e]:null})))},M=(0,o.D)({mutationFn:async e=>(await g.Z.patch("/api/admin/designs/".concat(t),e)).data,onSuccess:()=>{f.ZP.success("Design updated successfully!"),s.push("/admin/designs/".concat(t))},onError:e=>{var s,t;f.ZP.error((null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to update design"),j(!1)}}),V=async e=>{j(!0);let s=new FormData;s.append("title",e.title),s.append("description",e.description),s.append("price",e.price.toString()),s.append("difficulty",e.difficulty),s.append("stitchCount",e.stitchCount.toString()),s.append("featured",e.featured.toString()),s.append("popular",e.popular.toString()),e.categories.forEach(e=>{s.append("categories",e)}),q.forEach(e=>{s.append("formats",e)}),e.tags.split(",").map(e=>e.trim()).filter(Boolean).forEach(e=>{s.append("tags",e)}),s.append("existingImages",JSON.stringify(k)),N.forEach(e=>{s.append("images",e)}),Object.entries(F).forEach(e=>{let[t,a]=e;a&&s.append("designFile_".concat(t),a)}),M.mutate(s)};return R?(0,i.jsx)(y.Z,{children:(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})})}):(0,i.jsx)(y.Z,{children:(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,i.jsxs)("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,i.jsx)("div",{className:"mb-8",children:(0,i.jsx)("div",{className:"flex items-center justify-between",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(h.default,{href:"/admin/designs/".concat(t),className:"mr-4 p-2 rounded-full hover:bg-gray-200 transition-colors",children:(0,i.jsx)(m.Z,{className:"w-5 h-5 text-gray-600"})}),(0,i.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Design"})]})})}),(0,i.jsx)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:(0,i.jsxs)("form",{onSubmit:P(V),className:"p-6 space-y-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Basic Information"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"col-span-2",children:[(0,i.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,i.jsx)("input",(0,r._)((0,a._)({id:"title",type:"text"},E("title",{required:"Title is required"})),{className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-transparent"})),Z.title&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:Z.title.message})]}),(0,i.jsxs)("div",{className:"col-span-2",children:[(0,i.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),(0,i.jsx)("textarea",(0,r._)((0,a._)({id:"description",rows:4},E("description",{required:"Description is required"})),{className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-transparent"})),Z.description&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:Z.description.message})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700 mb-1",children:"Price ($) *"}),(0,i.jsx)("input",(0,r._)((0,a._)({id:"price",type:"number",step:"0.01",min:"0"},E("price",{required:"Price is required",min:{value:0,message:"Price must be positive"}})),{className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-transparent"})),Z.price&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:Z.price.message})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"stitchCount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Stitch Count *"}),(0,i.jsx)("input",(0,r._)((0,a._)({id:"stitchCount",type:"number",min:"0"},E("stitchCount",{required:"Stitch count is required",min:{value:0,message:"Stitch count must be positive"}})),{className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-transparent"})),Z.stitchCount&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:Z.stitchCount.message})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"difficulty",className:"block text-sm font-medium text-gray-700 mb-1",children:"Difficulty *"}),(0,i.jsxs)("select",(0,r._)((0,a._)({id:"difficulty"},E("difficulty",{required:"Difficulty is required"})),{className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[(0,i.jsx)("option",{value:"Beginner",children:"Beginner"}),(0,i.jsx)("option",{value:"Intermediate",children:"Intermediate"}),(0,i.jsx)("option",{value:"Advanced",children:"Advanced"})]})),Z.difficulty&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:Z.difficulty.message})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"categories",className:"block text-sm font-medium text-gray-700 mb-1",children:"Categories *"}),(0,i.jsx)("select",(0,r._)((0,a._)({id:"categories",multiple:!0},E("categories",{required:"At least one category is required"})),{className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-transparent",size:4,children:null==U?void 0:U.map(e=>(0,i.jsx)("option",{value:e._id,children:e.name},e._id))})),Z.categories&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:Z.categories.message}),(0,i.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Hold Ctrl/Cmd to select multiple categories"})]}),(0,i.jsxs)("div",{className:"col-span-2",children:[(0,i.jsx)("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags"}),(0,i.jsx)("input",(0,r._)((0,a._)({id:"tags",type:"text"},E("tags")),{className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter tags separated by commas"})),(0,i.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Separate tags with commas (e.g., floral, animal, holiday)"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Promotion Options"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("input",(0,r._)((0,a._)({id:"featured",type:"checkbox"},E("featured")),{className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})),(0,i.jsx)("label",{htmlFor:"featured",className:"ml-2 block text-sm text-gray-900",children:"Featured Design (appears on homepage)"})]}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("input",(0,r._)((0,a._)({id:"popular",type:"checkbox"},E("popular")),{className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})),(0,i.jsx)("label",{htmlFor:"popular",className:"ml-2 block text-sm text-gray-900",children:"Popular Design (appears in popular section)"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Available Formats"}),(0,i.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:["PES","DST","EXP","JEF","XXX","VP3","PDF"].map(e=>(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("input",{id:"format-".concat(e),type:"checkbox",checked:q.includes(e),onChange:s=>K(e,s.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,i.jsx)("label",{htmlFor:"format-".concat(e),className:"ml-2 block text-sm text-gray-900",children:e})]},e))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Design Files"}),(0,i.jsxs)("div",{className:"space-y-4",children:[q.map(e=>{var s;return(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsx)("span",{className:"text-sm font-medium text-gray-700 w-12",children:e}),F[e]?(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:"text-sm text-gray-600 truncate max-w-xs",children:null===(s=F[e])||void 0===s?void 0:s.name}),(0,i.jsx)("button",{type:"button",onClick:()=>J(e),className:"text-red-600 hover:text-red-800",children:(0,i.jsx)(u.Z,{className:"w-4 h-4"})})]}):(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("input",{type:"file",id:"file-".concat(e),onChange:s=>X(s,e),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),(0,i.jsxs)("div",{className:"flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-md bg-white text-sm text-gray-700 hover:bg-gray-50",children:[(0,i.jsx)(p.Z,{className:"w-4 h-4"}),(0,i.jsxs)("span",{children:["Upload ",e," file"]})]})]})]},e)}),0===q.length&&(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"Please select at least one format above to upload design files."})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Images"}),k.length>0&&(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Images"}),(0,i.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:k.map((e,s)=>(0,i.jsxs)("div",{className:"relative group",children:[(0,i.jsx)("div",{className:"aspect-square bg-gray-100 rounded-md overflow-hidden",children:(0,i.jsx)("img",{src:e.url,alt:e.alt||"Design image ".concat(s+1),className:"w-full h-full object-cover"})}),(0,i.jsx)("button",{type:"button",onClick:()=>T(s),className:"absolute top-2 right-2 p-1 bg-red-600 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity",children:(0,i.jsx)(u.Z,{className:"w-4 h-4"})})]},s))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Add New Images"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:[w.map((e,s)=>(0,i.jsxs)("div",{className:"relative group",children:[(0,i.jsx)("div",{className:"aspect-square bg-gray-100 rounded-md overflow-hidden",children:(0,i.jsx)("img",{src:e,alt:"New image ".concat(s+1),className:"w-full h-full object-cover"})}),(0,i.jsx)("button",{type:"button",onClick:()=>L(s),className:"absolute top-2 right-2 p-1 bg-red-600 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity",children:(0,i.jsx)(u.Z,{className:"w-4 h-4"})})]},s)),(0,i.jsxs)("div",{className:"aspect-square bg-gray-100 rounded-md flex items-center justify-center border-2 border-dashed border-gray-300",children:[(0,i.jsx)("input",{type:"file",id:"images",multiple:!0,accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files.length>0){let s=Array.from(e.target.files);v(e=>[...e,...s]);let t=s.map(e=>URL.createObjectURL(e));_(e=>[...e,...t])}},className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(x.Z,{className:"w-8 h-8 text-gray-400 mx-auto mb-1"}),(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"Add Image"})]})]})]})]})]}),(0,i.jsx)("div",{className:"flex justify-end pt-6 border-t border-gray-200",children:(0,i.jsx)("button",{type:"submit",disabled:b,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:bg-gray-400",children:b?"Updating...":"Update Design"})})]})})]})})})}},6325:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8301).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])}},function(e){e.O(0,[589,64,464,763,713,501,398,971,117,744],function(){return e(e.s=3845)}),_N_E=e.O()}]);