"use strict";(()=>{var e={};e.id=501,e.ids=[501],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},20151:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>y,serverHooks:()=>S,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{GET:()=>g,dynamic:()=>c});var a=r(49303),s=r(88716),i=r(60670),o=r(87070),u=r(75748),d=r(95456),p=r(93330),l=r(61563),m=r(45818);let c="force-dynamic";async function g(e){try{await (0,u.u)();let t=e.headers.get("authorization")?.replace("Bearer ","");if(!t)return o.NextResponse.json({message:"No token provided"},{status:401});let r=(0,d.W)(t);if(!r)return o.NextResponse.json({message:"Invalid token"},{status:401});let n=await p.Z.findById(r.userId).select("role");if(!n||"admin"!==n.role)return o.NextResponse.json({message:"Admin access required"},{status:403});let[a,s,i,c,g,y]=await Promise.all([p.Z.countDocuments(),l.Z.countDocuments(),m.Z.countDocuments({status:"completed"}),m.Z.aggregate([{$match:{status:"completed"}},{$group:{_id:null,total:{$sum:"$amount"}}}]),l.Z.find().select("title sales images").sort({sales:-1}).limit(5).lean(),m.Z.find({status:"completed"}).populate("user","username").populate("design","title").sort({createdAt:-1}).limit(5).lean()]),f={totalUsers:a,totalDesigns:s,totalSales:i,totalRevenue:c[0]?.total||0,topDesigns:g,recentTransactions:y};return o.NextResponse.json(f)}catch(e){return console.error("Get dashboard stats error:",e),o.NextResponse.json({message:"Server error"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/dashboard/route",pathname:"/api/admin/dashboard",filename:"route",bundlePath:"app/api/admin/dashboard/route"},resolvedPagePath:"C:\\stitchify\\src\\app\\api\\admin\\dashboard\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:S}=y,v="/api/admin/dashboard/route";function b(){return(0,i.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:h})}},95456:(e,t,r)=>{r.d(t,{W:()=>s});var n=r(41482),a=r.n(n);function s(e){try{return a().verify(e,process.env.JWT_SECRET||"fallback_secret")}catch(e){return null}}},75748:(e,t,r)=>{r.d(t,{u:()=>o});var n=r(11185),a=r.n(n);if(!process.env.MONGODB_URI)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=process.env.MONGODB_URI,i=global.mongoose;async function o(){if(i.conn)return i.conn;i.promise||(i.promise=a().connect(s,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}i||(i=global.mongoose={conn:null,promise:null})},61563:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),a=r.n(n);let s=new n.Schema({title:{type:String,required:!0,trim:!0},description:{type:String,required:!0},price:{type:Number,required:!0,min:0},images:[{url:{type:String,required:!0},alt:{type:String,required:!0}}],designFiles:{type:Map,of:String},categories:[{type:n.Schema.Types.ObjectId,ref:"Category",required:!0}],difficulty:{type:String,enum:["Beginner","Intermediate","Advanced"],default:"Beginner"},stitchCount:{type:Number,min:0},downloads:{type:Number,default:0},rating:{average:{type:Number,default:0,min:0,max:5},count:{type:Number,default:0}},sales:{type:Number,default:0},featured:{type:Boolean,default:!1},popular:{type:Boolean,default:!1},formats:[{type:String,enum:["SVG","PNG","DST","PES","JEF","EXP","HUS","VP3"]}],tags:[{type:String,trim:!0}]},{timestamps:!0}),i=a().models.Design||a().model("Design",s)},45818:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),a=r.n(n);let s=new n.Schema({user:{type:n.Schema.Types.ObjectId,ref:"User",required:!0},design:{type:n.Schema.Types.ObjectId,ref:"Design",required:!0},amount:{type:Number,required:!0,min:0},status:{type:String,enum:["pending","completed","failed","cancelled"],default:"pending"},paymentMethod:{type:String,required:!0,default:"paypal"},paymentId:{type:String},paypalToken:{type:String},payerId:{type:String}},{timestamps:!0}),i=a().models.Transaction||a().model("Transaction",s)},93330:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),a=r.n(n);let s=new n.Schema({username:{type:String,required:!0,unique:!0,trim:!0,minlength:3},email:{type:String,required:!0,unique:!0,trim:!0,lowercase:!0},password:{type:String,required:!0,minlength:6},role:{type:String,enum:["user","admin"],default:"user"},favorites:[{type:n.Schema.Types.ObjectId,ref:"Design"}]},{timestamps:!0}),i=a().models.User||a().model("User",s)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972,482],()=>r(20151));module.exports=n})();