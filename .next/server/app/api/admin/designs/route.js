"use strict";(()=>{var e={};e.id=997,e.ids=[997],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},1099:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>S,requestAsyncStorage:()=>y,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var i={};r.r(i),r.d(i,{POST:()=>c,dynamic:()=>g});var a=r(49303),n=r(88716),s=r(60670),o=r(87070),d=r(75748),l=r(61563),u=r(92048),p=r(55315),m=r.n(p);let g="force-dynamic";async function c(e){try{await (0,d.u)();let t=await e.formData(),r=t.get("title"),i=t.get("description"),a=parseFloat(t.get("price")),n=t.get("difficulty"),s=parseInt(t.get("stitchCount")||"0"),p=t.getAll("categories"),g=t.getAll("formats"),c=t.getAll("tags"),f=(await l.Z.create({title:r,description:i,price:a,difficulty:n,stitchCount:s,categories:p,formats:g,tags:c,images:[],designFiles:{},featured:!1,downloads:0,sales:0,rating:{average:0,count:0}}))._id.toString(),y=m().join(process.cwd(),"public","uploads","designs",f),h=m().join(y,"files"),w=m().join(y,"images");await u.promises.mkdir(h,{recursive:!0}),await u.promises.mkdir(w,{recursive:!0});let v=t.getAll("images"),S=[];for(let e=0;e<v.length;e++){let t=v[e],i=m().extname(t.name),a=`image_${e+1}${i}`,n=m().join(w,a),s=await t.arrayBuffer(),o=Buffer.from(s);await u.promises.writeFile(n,o),S.push({url:`/uploads/designs/${f}/images/${a}`,alt:r})}let x={};for(let[e,r]of Array.from(t.entries()))if(e.startsWith("designFiles[")&&e.endsWith("]")){let t=e.slice(13,-1);if(r&&r.size>0){let e=m().extname(r.name)||`.${t.toLowerCase()}`,i=`design.${t.toLowerCase()}${e}`,a=m().join(h,i),n=await r.arrayBuffer(),s=Buffer.from(n);await u.promises.writeFile(a,s),x[t]=`/uploads/designs/${f}/files/${i}`}}let b=await l.Z.findByIdAndUpdate(f,{images:S,designFiles:x},{new:!0});return o.NextResponse.json(b,{status:201})}catch(e){return console.error("Create design error:",e),o.NextResponse.json({message:e.message||"Failed to create design"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/designs/route",pathname:"/api/admin/designs",filename:"route",bundlePath:"app/api/admin/designs/route"},resolvedPagePath:"C:\\stitchify\\src\\app\\api\\admin\\designs\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:w}=f,v="/api/admin/designs/route";function S(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},75748:(e,t,r)=>{r.d(t,{u:()=>o});var i=r(11185),a=r.n(i);if(!process.env.MONGODB_URI)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let n=process.env.MONGODB_URI,s=global.mongoose;async function o(){if(s.conn)return s.conn;s.promise||(s.promise=a().connect(n,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}s||(s=global.mongoose={conn:null,promise:null})},61563:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(11185),a=r.n(i);let n=new i.Schema({title:{type:String,required:!0,trim:!0},description:{type:String,required:!0},price:{type:Number,required:!0,min:0},images:[{url:{type:String,required:!0},alt:{type:String,required:!0}}],designFiles:{type:Map,of:String},categories:[{type:i.Schema.Types.ObjectId,ref:"Category",required:!0}],difficulty:{type:String,enum:["Beginner","Intermediate","Advanced"],default:"Beginner"},stitchCount:{type:Number,min:0},downloads:{type:Number,default:0},rating:{average:{type:Number,default:0,min:0,max:5},count:{type:Number,default:0}},sales:{type:Number,default:0},featured:{type:Boolean,default:!1},popular:{type:Boolean,default:!1},formats:[{type:String,enum:["SVG","PNG","DST","PES","JEF","EXP","HUS","VP3"]}],tags:[{type:String,trim:!0}]},{timestamps:!0}),s=a().models.Design||a().model("Design",n)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,972],()=>r(1099));module.exports=i})();