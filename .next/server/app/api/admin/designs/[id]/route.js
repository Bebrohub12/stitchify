"use strict";(()=>{var e={};e.id=799,e.ids=[799],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},85337:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>N,patchFetch:()=>j,requestAsyncStorage:()=>h,routeModule:()=>w,serverHooks:()=>v,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{DELETE:()=>y,GET:()=>c,PATCH:()=>f,dynamic:()=>m});var i=r(49303),n=r(88716),a=r(60670),o=r(87070),d=r(75748),u=r(61563),l=r(92048),p=r(55315),g=r.n(p);let m="force-dynamic";async function c(e,{params:t}){try{await (0,d.u)();let e=await u.Z.findById(t.id).populate("categories","name slug description").lean();if(!e)return o.NextResponse.json({message:"Design not found"},{status:404});return o.NextResponse.json(e)}catch(e){return console.error("Get admin design error:",e),o.NextResponse.json({message:"Server error"},{status:500})}}async function f(e,{params:t}){try{await (0,d.u)();let r=t.id,s=await e.formData(),i=await u.Z.findById(r);if(!i)return o.NextResponse.json({message:"Design not found"},{status:404});let n=s.get("title"),a=s.get("description"),p=parseFloat(s.get("price")),m=s.get("difficulty"),c=parseInt(s.get("stitchCount")||"0"),f="true"===s.get("featured"),y="true"===s.get("popular"),w=s.getAll("categories"),h=s.getAll("formats"),x=s.getAll("tags"),v=[],N=s.get("existingImages");N&&"string"==typeof N&&(v=JSON.parse(N));let j=g().join(process.cwd(),"public","uploads","designs",r),S=g().join(j,"files"),B=g().join(j,"images");await l.promises.mkdir(S,{recursive:!0}),await l.promises.mkdir(B,{recursive:!0});let D=s.getAll("images"),b=[];for(let e=0;e<D.length;e++){let t=D[e],s=g().extname(t.name),i=`image_${Date.now()}_${e}${s}`,a=g().join(B,i),o=await t.arrayBuffer(),d=Buffer.from(o);await l.promises.writeFile(a,d),b.push({url:`/uploads/designs/${r}/images/${i}`,alt:n})}let R=[...v,...b],q={...i.designFiles};for(let[e,t]of Array.from(s.entries()))if(e.startsWith("designFile_")&&t instanceof File&&t.size>0){let s=e.replace("designFile_",""),i=g().extname(t.name)||`.${s.toLowerCase()}`,n=`design_${Date.now()}.${s.toLowerCase()}${i}`,a=g().join(S,n),o=await t.arrayBuffer(),d=Buffer.from(o);await l.promises.writeFile(a,d),q[s]=`/uploads/designs/${r}/files/${n}`}let A=await u.Z.findByIdAndUpdate(r,{title:n,description:a,price:p,difficulty:m,stitchCount:c,categories:w,formats:h,tags:x,images:R,designFiles:q,featured:f,popular:y},{new:!0}).populate("categories","name slug description");return o.NextResponse.json(A)}catch(e){return console.error("Update design error:",e),o.NextResponse.json({message:e.message||"Failed to update design"},{status:500})}}async function y(e,{params:t}){try{await (0,d.u)();let e=t.id;if(!await u.Z.findById(e))return o.NextResponse.json({message:"Design not found"},{status:404});await u.Z.findByIdAndDelete(e);try{let t=g().join(process.cwd(),"public","uploads","designs",e);await l.promises.rm(t,{recursive:!0,force:!0})}catch(e){console.error("Error deleting design files:",e)}return o.NextResponse.json({message:"Design deleted successfully"})}catch(e){return console.error("Delete design error:",e),o.NextResponse.json({message:"Server error"},{status:500})}}let w=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/designs/[id]/route",pathname:"/api/admin/designs/[id]",filename:"route",bundlePath:"app/api/admin/designs/[id]/route"},resolvedPagePath:"C:\\stitchify\\src\\app\\api\\admin\\designs\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:v}=w,N="/api/admin/designs/[id]/route";function j(){return(0,a.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:x})}},75748:(e,t,r)=>{r.d(t,{u:()=>o});var s=r(11185),i=r.n(s);if(!process.env.MONGODB_URI)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let n=process.env.MONGODB_URI,a=global.mongoose;async function o(){if(a.conn)return a.conn;a.promise||(a.promise=i().connect(n,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}a||(a=global.mongoose={conn:null,promise:null})},61563:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(11185),i=r.n(s);let n=new s.Schema({title:{type:String,required:!0,trim:!0},description:{type:String,required:!0},price:{type:Number,required:!0,min:0},images:[{url:{type:String,required:!0},alt:{type:String,required:!0}}],designFiles:{type:Map,of:String},categories:[{type:s.Schema.Types.ObjectId,ref:"Category",required:!0}],difficulty:{type:String,enum:["Beginner","Intermediate","Advanced"],default:"Beginner"},stitchCount:{type:Number,min:0},downloads:{type:Number,default:0},rating:{average:{type:Number,default:0,min:0,max:5},count:{type:Number,default:0}},sales:{type:Number,default:0},featured:{type:Boolean,default:!1},popular:{type:Boolean,default:!1},formats:[{type:String,enum:["SVG","PNG","DST","PES","JEF","EXP","HUS","VP3"]}],tags:[{type:String,trim:!0}]},{timestamps:!0}),a=i().models.Design||i().model("Design",n)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(85337));module.exports=s})();